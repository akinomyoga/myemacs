

-------------------------------------------------------------------------------
  Done
-------------------------------------------------------------------------------

2016-04-03

* ドキュメントコメントの行頭にあるヘッダを無視する統一的な方法

  行頭にあるヘッダというのは以下に示すような部分の事である。

  | /// comments
  | /// comments
  | /// comments
  | ~~~~
  | ↑この部分
  |
  | //?lwiki comments
  | //?lwiki comments
  | //?lwiki comments
  | ~~~~~~~~~
  |   ↑この部分
  |
  | /*?lwiki
  |  * comments
  |  * comments
  |  * comments
  | ~~~
  | ↑この部分
  |  */

  これらはドキュメントとしての着色部分ではない。
  背景色はこれ以外の部分につけるべきである。
  埋め込まれた言語 (tex 数式や c++ のコード例) の着色の際にもこの部分は無視する必要がある。

  * tex, simple-c++ で背景色設定部分を統一する

  * そもそも現状のコードだと lwiki inline コメント形式の場合に
    リスト項目 - 等が正しく認識されていない。
    "行頭にあっても無視する物のパターン" というのを分離しておく必要がある。

    → mwg-doxygen/doc:{doxigen,lwiki}/rex-line-head

    という変数に入れて必要に応じて参照して正規表現を構築する。

  * 更に、tex-keylist や simple-c++-keylist 内部で
    行頭にあっても無視するパターンというのを認識する必要がある。

    ※今迄は既に着色されている face を見て背景色を設定するかどうか決めていた (chkset)。
      しかしこの方法には限界がある。これによって背景色を正しく設定できるようにはなるが、
      他の箇所でも様々な問題が残る。

      例えば、行頭のパターン '///' や '//?lwiki' は、
      simple-c++ のコメントに一致している為、そのまま着色しようとすると、
      '///' や '//?lwiki' も含めて行全体がコメントだと判定されて着色されてしまう。
      simple-c++ のコメントを判定する部分でも適切に行を無視する必要がある。

    従って、simple-c++ などの埋め込み言語から、
    外側のコメントスタイルに応じて行頭パターンを無視する様にしなければならない。
    この為に、外側のコメントスタイルで

      mwg-doxygen/doc:{doxigen,lwiki}/rex-line-head

    を適当なローカル変数

      mwg-doxygen/local:document-line-head

    に入れて、行頭判定の際にはこれを参照する様にした。

    また使用時に正規表現を生成できる様に、
    mwg-doxygen/font-lock-apply-keyword の引数 regexp
    を実行前に eval する様に変更した。

2016-03-31

* mwg-doxygen: 行ドキュメントの結合に関連して

  ///
  ///
  ///
  int main(){}

  の様に連続する /// コメントがあった場合に

  1 int の直前まで着色される。
    また、/// の前の空白も着色されているのは変な感じがする。
    →修正した。

  2 コメントは最初の行コメントの最初から最後の行コメントの末端までである。
    この時最初の行のインデントは着色されないがそれ以降は全て着色される。
    インデントは着色しないように統一したい。

    ドキュメント全体の着色を担当している部分は
    関数 mwg-doxygen/c-font-lock-doc-comments の中の以下の一行である。

    (c-put-font-lock-face region-beg region-end c-doc-face-name)

    これを off にするとドキュメント本文だけが着色された状態になる。
    できる事ならば行末まで着色したい。
